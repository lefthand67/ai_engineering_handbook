# Шаблоны метрик и практического контроля качества для продуктов с LLM


> Владелец: Вадим Рудаков, lefthand67@gmail.com

Ниже представлены шаблоны метрик и практического контроля качества для продуктов с LLM. Эти шаблоны помогут организовать системный подход к измерению и улучшению качества.

## Как применять шаблоны

1. В начале проекта выделите время для создания начального тестового набора и выбора метрик.  
2. Автоматизируйте проверку базовых метрик безотлагательно — интегрируйте запуск в CI/CD.  
3. Включите ручную экспертизу и систему сбора обратной связи для улучшения метрик.  
4. Обновляйте и пересматривайте тесты и метрики по мере развития продукта и появления новых задач.  
5. Документируйте всё в прозрачных форматах и делайте доступным для команды.

## Шаблон метрик качества для LLM-продуктов

| Метрика                       | Описание                                            | Тип задачи                            | Пример KPI/Цель                      | Способы измерения                         |
|------------------------------|----------------------------------------------------|-------------------------------------|------------------------------------|-------------------------------------------|
| Точность (Accuracy)           | Доля правильных ответов от общего числа            | Классификация, распознавание        | ≥ 90% точных ответов                | Автотесты на контрольном датасете         |
| Полнота (Recall)              | Доля найденных релевантных элементов из всех      | Классификация, поиск                 | ≥ 85% релевантных результатов       | Анализ разметки, сравнительный тест       |
| F1-Score                     | Гармоническое среднее точности и полноты          | Классификация                      | ≥ 0.88                            | Автоматические метрики на тестах          |
| Когерентность (Coherence)     | Логическая связность и связность ответов          | Генерация текста                   | Средняя оценка ≥ 4 из 5            | Human-in-the-loop, экспертная оценка      |
| Релевантность (Relevance)     | Соответствие ответов запросу пользователя          | Генерация, поиск                   | ≥ 90% релевантных ответов          | Отзывы пользователей и автоанализ         |
| Время отклика (Latency)       | Время ответа сервиса                                | Сервисы в реальном времени        | ≤ 200 мс                       | Логирование времени ответов                |
| Частота ошибок (Error Rate)   | Доля некорректных или нерелевантных ответов        | Все типы                         | ≤ 5% ошибок                     | Автоматический и ручной анализ             |
| Уровень галлюцинаций (Hallucination Rate) | Частота генерации ложной информации               | Генеративные задачи               | ≤ 2% случаев                  | Ручные проверки, анализ клиентского фидбэка|
| Показатели пользовательского удовлетворения (NPS, CSAT) | Оценка удовлетворенности пользователей             | Все                             | NPS ≥ 50, CSAT ≥ 4.5/5          | Опросы пользователей                       |

## Шаблон контроля качества: чеклист для регулярного аудита LLM-системы

- [ ] Определены и документированы ключевые метрики качества  
- [ ] Создан и актуализирован тестовый датасет с реальными и граничными кейсами  
- [ ] Осуществляется регулярный запуск автотестов для проверки функциональности и качества  (CI/CD)
- [ ] Проведена экспертная оценка выборочных результатов (human-in-the-loop)  
- [ ] Собирается и анализируется пользовательский фидбэк с тегированием проблем  
- [ ] Ведется журнал версий моделей и промптов с привязкой к результатам тестирования  
- [ ] Настроен мониторинг времени отклика и стабильности сервиса  
- [ ] Продуман и реализован процесс регрессионного тестирования после обновлений  
- [ ] Организованы A/B тесты для проверки новых версий и гипотез улучшения  
- [ ] Разработаны планы итеративных улучшений на основе собранных данных  
- [ ] Команда информирована о текущем состоянии качества и вовлечена в процессы улучшения  

1. **Определение ожидаемых результатов**  
   - Определить критерии успешного результата (ключевые факты, релевантность, полнота).  
   - Указать допустимый диапазон ответов, а не жёсткое совпадение.<br>
<br>
2. **Разработка тестовых примеров**  
   - Выбрать разнообразные сценарии, включая пограничные случаи и типичные задачи.  
   - Включить негативные тесты с некорректным или неоднозначным вводом.<br>
<br>
3. **Автоматизация проверки**  
   - Настроить проверку ключевых слов и фраз, шаблонов в ответах.  
   - Использовать регулярные выражения и семантический анализ (например, cosine similarity по эмбеддингам).<br>
<br>
4. **Ручное ревью и human-in-the-loop**  
   - Обеспечить периодическую проверку результатов человеком для оценки качества и обнаружения галлюцинаций.<br>
<br>
5. **Версионирование тестов и привязка к промптам**  
   - Связывать тесты с конкретными версиями промптов и моделей.<br>
<br>
6. **Интеграция в CI/CD**  
   - Автоматический запуск тестов при коммитах изменений в промптах или коде агентов.  
   - Мониторинг и оповещение о регрессиях в качестве.