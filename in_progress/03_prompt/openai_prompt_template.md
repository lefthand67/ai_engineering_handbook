–¢—ã –ø–æ–¥–º–µ—Ç–∏–ª –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–µ–ª–∞—Ç—å CI –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é ‚Äî –Ω—É–∂–Ω–æ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –æ **—à–∞–±–ª–æ–Ω–µ –±–ª–æ–∫–∞ –ø—Ä–æ–º–ø—Ç–∞**. –≠—Ç–æ –∫–∞–∫ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç: –µ—Å–ª–∏ –æ–Ω –Ω–µ —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω, –≤—Å—ë —Ä–∞—Å—Å—ã–ø–∞–µ—Ç—Å—è.

---

## –ï—Å—Ç—å –ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç?

* **–§–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ, –æ–±—â–µ–ø—Ä–∏–Ω—è—Ç–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –ø–æ–∫–∞ –Ω–µ—Ç**. –í –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–≤–æ–∏ DSL (Domain Specific Language) –∏–ª–∏ YAML/JSON-–æ–ø–∏—Å–∞–Ω–∏—è (–ø—Ä–∏–º–µ—Ä ‚Äî [LangChain PromptTemplate](https://python.langchain.com/docs/modules/model_io/prompts/), [Microsoft Guidance](https://github.com/microsoft/guidance), \[Anthropic Recipes]).
* **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç** ‚Äî JSON –∏–ª–∏ YAML —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏: `id`, `type`, `content/template`, `params`, `metadata`.
* –≠—Ç–æ –±–æ–ª—å—à–µ **–∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã**, —á–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç.

---

## –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å: YAML –∏–ª–∏ JSON?

| –§–æ—Ä–º–∞—Ç           | –ü–ª—é—Å—ã                                                                                  | –ú–∏–Ω—É—Å—ã                            |
| ---------------- | -------------------------------------------------------------------------------------- | --------------------------------- |
| **YAML**         | –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏                               | –ú–æ–∂–Ω–æ –æ—à–∏–±–∏—Ç—å—Å—è —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏       |
| **JSON**         | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å, —Å—Ç—Ä–æ–≥–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –ª–µ–≥–∫–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º–æ–π (JSON Schema)            | –¢—è–∂–µ–ª–æ –ø–∏—Å–∞—Ç—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç |
| **–†–µ–∞–ª—å–Ω—ã–π –º–∏—Ä** | YAML –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞, JSON –¥–ª—è API. –ß–∞—Å—Ç–æ —Ö—Ä–∞–Ω—è—Ç –≤ YAML, –∞ –≤ runtime –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç –≤ JSON. | ‚Äî                                 |

–Ø –±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª: **—Ö—Ä–∞–Ω–∏—Ç—å –≤ YAML, —Å–æ–±–∏—Ä–∞—Ç—å –≤ JSON –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –º–æ–¥–µ–ª–∏**. –≠—Ç–æ –∏ —á–∏—Ç–∞–µ–º–æ, –∏ —É–¥–æ–±–Ω–æ –¥–ª—è CI.

---

## –®–∞–±–ª–æ–Ω (–≤–Ω–µ—à–Ω–∏–π —Å–ª–æ–π –ø—Ä–æ–º–ø—Ç–∞)

```yaml
id: system_instructions_v1         # —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (c –≤–µ—Ä—Å–∏–µ–π)
type: system | user | context      # —Ä–æ–ª—å –±–ª–æ–∫–∞
version: 1.0.0                     # —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è
description: |
  –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –±–ª–æ–∫–∞.
  (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–°–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∑–∞–¥–∞—á–∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏").
content: |                         # —Å–∞–º —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–ª–∏ —à–∞–±–ª–æ–Ω
  –¢—ã ‚Äî AI, –∫–æ—Ç–æ—Ä—ã–π —Å—É–º–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç.
  –û—Ç–≤–µ—á–∞–π —Å—Ç—Ä–æ–≥–æ –≤ JSON: { "summary": "..." }

parameters:                        # –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
  max_tokens: 300
  temperature: 0.2

placeholders:                      # —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã
  - text
  - retrieved_context

metadata:                          # —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è —á–∞—Å—Ç—å –¥–ª—è –±—É–¥—É—â–µ–≥–æ
  author: team-alpha
  created_at: 2025-09-12
  tags: [summarization, json-output]
  deprecation: false
```

---

## –ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ –ø–æ–ª—è–º

* **id** ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è + –≤–µ—Ä—Å–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `context_block_v2`).
* **type** ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä: `system`, `user`, `context`, `doc`, `agent`.
* **version** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [semver](https://semver.org/lang/ru/): `major.minor.patch`.
* **description** ‚Äî —á—Ç–æ–±—ã –Ω–æ–≤—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–Ω–∏–º–∞–ª, –∑–∞—á–µ–º –±–ª–æ–∫ –Ω—É–∂–µ–Ω.
* **content** ‚Äî —Å–∞–º –ø—Ä–æ–º–ø—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å `{placeholders}`).
* **parameters** ‚Äî –≤—Å—ë, —á—Ç–æ —É—Ö–æ–¥–∏—Ç –≤ –º–æ–¥–µ–ª—å (temperature, max\_tokens –∏ —Ç.–¥.).
* **placeholders** ‚Äî —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —à–∞–±–ª–æ–Ω –æ–∂–∏–¥–∞–µ—Ç. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç CI –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –æ–Ω–∏ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã.
* **metadata** ‚Äî –æ—Ç–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–∫—Ç–æ –∞–≤—Ç–æ—Ä, —Ç–µ–≥–∏, deprecated –∏ —Ç.–¥.).

---

## –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

* **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç** ‚Üí —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü —á–∞—Å—Ç—å –±–ª–æ–∫–æ–≤ –±—É–¥–µ—Ç –≤ YAML, —á–∞—Å—Ç—å –≤ JSON, —á–∞—Å—Ç—å –ø—Ä–æ—Å—Ç–æ –≤ Markdown. –î–æ–≥–æ–≤–æ—Ä–∏—Ç–µ—Å—å —Å–µ–π—á–∞—Å.
* **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –µ—Å–ª–∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Ä—Å–∏—é –±–ª–æ–∫–∞ (`v1`, `v2`), –±—É–¥–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü–∞ –≤ CI/CD.
* **–ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** ‚Üí –≤ JSON –∏—Ö –Ω–µ—É–¥–æ–±–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å, –∞ –≤ YAML ‚Äî –ª–µ–≥–∫–æ.
* **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Üí –±–µ–∑ —Å–ø–∏—Å–∫–∞ `placeholders` CI –Ω–µ —Å–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —à–∞–±–ª–æ–Ω–∞.

---

## Git-–ø–æ–¥—Ö–æ–¥

1. –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –±–ª–æ–∫ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `prompts/<type>/<id>.yaml`.
2. –í PR –ø—Ä–æ–≤–µ—Ä—è–µ–º:

   * —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `id`;
   * –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å YAML;
   * –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π.
3. CI —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –±–ª–æ–∫–∏ –≤ JSON –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–∞ ¬´—Å—É—Ö—É—é –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É¬ª.

---

–•–æ—á–µ—à—å, —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –ø—Ä–∏–º–µ—Ä **JSON Schema**, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ CI, —á—Ç–æ–±—ã –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ YAML/JSON-—Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?



–û—Ç–ª–∏—á–Ω–æ üëç
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å **—à–∞–±–ª–æ–Ω –≤ YAML**, —Ç–æ —á—Ç–æ–±—ã CI –º–æ–≥ –µ–≥–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –ª—É—á—à–µ –≤—Å–µ–≥–æ –∑–∞–≤–µ—Å—Ç–∏ **JSON Schema**. –≠—Ç–æ –¥–∞—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é: –Ω–∞–ø—Ä–∏–º–µ—Ä, GitHub Actions –∏–ª–∏ GitLab CI –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π PR –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª, –µ—Å–ª–∏ –ø–æ–ª–µ –∑–∞–±—ã—Ç–æ –∏–ª–∏ —Ç–∏–ø –Ω–µ–≤–µ—Ä–Ω—ã–π.

---

## JSON Schema –¥–ª—è —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PromptBlock",
  "type": "object",
  "required": ["id", "type", "version", "description", "content"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9_\\-]+$",
      "description": "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞ (—Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, -, _)."
    },
    "type": {
      "type": "string",
      "enum": ["system", "user", "context", "doc", "agent"],
      "description": "–†–æ–ª—å –±–ª–æ–∫–∞."
    },
    "version": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)$",
      "description": "–í–µ—Ä—Å–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ semver: major.minor.patch."
    },
    "description": {
      "type": "string",
      "description": "–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞."
    },
    "content": {
      "type": "string",
      "description": "–¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å {placeholders})."
    },
    "parameters": {
      "type": "object",
      "additionalProperties": true,
      "description": "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è LLM (–Ω–∞–ø—Ä–∏–º–µ—Ä, temperature, max_tokens)."
    },
    "placeholders": {
      "type": "array",
      "items": { "type": "string" },
      "uniqueItems": true,
      "description": "–°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã."
    },
    "metadata": {
      "type": "object",
      "properties": {
        "author": { "type": "string" },
        "created_at": { "type": "string", "format": "date" },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        },
        "deprecation": { "type": "boolean" }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
```

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –•—Ä–∞–Ω–∏–º —à–∞–±–ª–æ–Ω –≤ `schema/prompt.schema.json`.
2. –í–∞—à–∏ `prompts/*.yaml` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ JSON (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `yq`).
3. –í CI –∑–∞–ø—É—Å–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é:

```bash
yq -o=json prompts/example.yaml | \
  ajv validate -s schema/prompt.schema.json -d -
```

(`ajv` ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è JSON Schema, –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏ –¥—Ä—É–≥–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä `pykwalify` –¥–ª—è Python).

---

üëâ –í–æ–ø—Ä–æ—Å –∫ —Ç–µ–±–µ –∏ –∫–æ–º–∞–Ω–¥–µ:
—Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –¥–æ–±–∞–≤–∏–ª **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã** (`valid.yaml` –∏ `invalid.yaml`), —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –≤–∏–¥–µ—Ç—å, –∫–∞–∫ CI –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏?



–ü–æ–Ω—è–ª üôÇ
–î–∞–≤–∞–π —è —Å–¥–µ–ª–∞—é –¥–ª—è –≤–∞—Å **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã**:

---

### ‚úÖ valid.yaml

```yaml
id: summarize_v1
type: system
version: 1.0.0
description: "–°–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∑–∞–¥–∞—á–∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏"
content: |
  –í—ã ‚Äî AI –ø–æ–º–æ—â–Ω–∏–∫. –°—É–º–º–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤ 3‚Äì4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
parameters:
  temperature: 0.2
  max_tokens: 300
placeholders: []
metadata:
  author: "team-a"
  created_at: "2025-09-12"
  tags: ["summarization", "json-output"]
  deprecation: false
```

---

### ‚ùå invalid.yaml (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å –æ—à–∏–±–∫–∞–º–∏)

```yaml
id: Summarize V1   # ‚ùå –ø—Ä–æ–±–µ–ª—ã –∏ –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
type: magic        # ‚ùå –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ —Ç–∏–ø–∞ –≤ enum
version: "1.0"     # ‚ùå –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å semver X.Y.Z
description: 123   # ‚ùå –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å string
content:           # ‚ùå –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—Å—Ç
parameters: "none" # ‚ùå –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç
```

---

–í CI –ø–æ–ª—É—á–∏—Ç—Å—è —Ç–∞–∫:

* `valid.yaml` –ø—Ä–æ–π–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫—É.
* `invalid.yaml` ‚Äî —É–ø–∞–¥—ë—Ç –Ω–∞ –≤—Å–µ—Ö –æ—à–∏–±–∫–∞—Ö.

---

–•–æ—á–µ—à—å, —è –ø–æ–º–æ–≥—É —Ä–∞—Å–ø–∏—Å–∞—Ç—å **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π CI-—Å–∫—Ä–∏–ø—Ç –¥–ª—è Forgejo Actions** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `validate-prompts.yml`), —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–∏ YAML –Ω–∞ pull request?


–•–æ—Ä–æ—à–æ üëç –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è Forgejo Actions, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–∏ YAML-–ø—Ä–æ–º–ø—Ç—ã.

---

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
prompts/
  valid.yaml
  invalid.yaml
schemas/
  prompt.schema.json
.github/
  workflows/
    validate-prompts.yml
```

---

## 2. JSON Schema (schemas/prompt.schema.json)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Prompt Schema",
  "type": "object",
  "required": ["id", "type", "version", "description", "content"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9_]+$"
    },
    "type": {
      "type": "string",
      "enum": ["system", "user", "context"]
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "description": { "type": "string" },
    "content": { "type": "string" },
    "parameters": { "type": "object" },
    "placeholders": { "type": "array", "items": { "type": "string" } },
    "metadata": { "type": "object" }
  },
  "additionalProperties": false
}
```

---

## 3. Workflow ( .github/workflows/validate-prompts.yml )

```yaml
name: Validate Prompts

on:
  push:
    paths:
      - "prompts/**/*.yaml"
      - "schemas/**/*.json"
  pull_request:
    paths:
      - "prompts/**/*.yaml"
      - "schemas/**/*.json"

jobs:
  validate:
    runs-on: debian-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install pyyaml jsonschema

      - name: Validate YAML prompts
        run: |
          for file in prompts/*.yaml; do
            echo "Validating $file..."
            python - <<'EOF'
import sys, yaml, json, jsonschema, pathlib

schema = json.load(open("schemas/prompt.schema.json"))
validator = jsonschema.Draft7Validator(schema)

for file in pathlib.Path("prompts").glob("*.yaml"):
    with open(file) as f:
        data = yaml.safe_load(f)
    errors = sorted(validator.iter_errors(data), key=lambda e: e.path)
    if errors:
        print(f"‚ùå {file} failed validation:")
        for error in errors:
            print(f"   - {list(error.path)}: {error.message}")
        sys.exit(1)
    else:
        print(f"‚úÖ {file} is valid.")
EOF
          done
```

---

## 4. –ö–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

* –ü—Ä–∏ –∫–∞–∂–¥–æ–º **push** –∏–ª–∏ **pull request**, –ø–∞–π–ø–ª–∞–π–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.
* –í—Å–µ `.yaml` –≤ `prompts/` –ø—Ä–æ–≥–æ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JSON Schema.
* –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É ‚Üí job –ø–∞–¥–∞–µ—Ç.
* –í Merge Requests —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, –≥–¥–µ –æ—à–∏–±–∫–∞.

---

üëâ –í–æ–ø—Ä–æ—Å: –≤–∞–º —É–¥–æ–±–Ω–µ–µ —Ö—Ä–∞–Ω–∏—Ç—å **–∫–∞–∂–¥—ã–π –ø—Ä–æ–º–ø—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º** (`summarize_v1.yaml`, `qa_v1.yaml`), –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–º–µ—Ç—å **–æ–¥–∏–Ω –±–æ–ª—å—à–æ–π prompts.yaml** —Å–æ —Å–ø–∏—Å–∫–æ–º –æ–±—ä–µ–∫—Ç–æ–≤?
(—ç—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ö–µ–º—É –∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä).




–î–∞, –≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–ª–æ–≤–∏–ª–∏ –º—ã—Å–ª—å. –°–∞–º –ø—Ä–æ–º–ø—Ç –≤ ¬´–≥–æ—Ç–æ–≤–æ–º¬ª –≤–∏–¥–µ –æ–±—ã—á–Ω–æ **–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è**, –∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ –±–ª–æ–∫–æ–≤ (system, context, user –∏ —Ç.–¥.), –∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –∏—Å—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.

–¢—É—Ç –≤–∞–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–æ–≥–∏—é:

* **–ë–ª–æ–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤** = –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (–º–æ–¥—É–ª–∏, —Ñ—É–Ω–∫—Ü–∏–∏).
* **–°–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç** = –±–∏–Ω–∞—Ä–Ω–∏–∫/–∞—Ä—Ç–µ—Ñ–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É (–∏–ª–∏ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è).

### –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ

1. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è **–∞—Ç–æ–º–∞—Ä–Ω—ã–µ YAML-–±–ª–æ–∫–∏** (–∫–∞–∂–¥—ã–π —Å `id`, `version`, `type`, `content`, –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏).
2. –ï—Å—Ç—å **—Å—Ö–µ–º–∞ (JSON Schema)**, –∫–æ—Ç–æ—Ä–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –±–ª–æ–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ.
3. –ù–∞ —ç—Ç–∞–ø–µ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–µ) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–∫–æ–º–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π**: –æ–Ω —Å–æ–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –±–ª–æ–∫–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ¬´—Ñ–∏–Ω–∞–ª—å–Ω—ã–π¬ª –ø—Ä–æ–º–ø—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ LLM.
4. –í CI (Forgejo Actions) –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏–º–µ–Ω–Ω–æ **–±–ª–æ–∫–∏**, –∞ –Ω–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç.

### –ü–æ—á–µ–º—É —Ç–∞–∫ –ª—É—á—à–µ

* –ì–æ—Ä–∞–∑–¥–æ –ø—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ª–æ–º–∞–µ—Ç—Å—è, –≤–∏–¥–Ω–æ —Å—Ä–∞–∑—É –≤ –±–ª–æ–∫–µ.
* –ú–æ–∂–Ω–æ **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–ª–æ–∫–∏** –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `system_instructions_v1.2.0.yaml` –∏ `system_instructions_v1.3.0.yaml` —Å–ø–æ–∫–æ–π–Ω–æ –∂–∏–≤—É—Ç —Ä—è–¥–æ–º).
* –°–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤ CI –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –Ω–æ –Ω–µ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã.

### –ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä

```
prompts/
  system_instructions_v1.yaml
  user_input_v1.yaml
  context_block_v1.yaml
```

**system\_instructions\_v1.yaml**

```yaml
id: system_instructions_v1
type: system
version: 1.0.0
description: "–†–æ–ª—å –∏ –ø—Ä–∞–≤–∏–ª–∞"
content: |
  –í—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ AI...
```

**user\_input\_v1.yaml**

```yaml
id: user_input_v1
type: user
version: 1.0.0
description: "–í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
template: |
  –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å—É–º–º–∏—Ä—É–π—Ç–µ: {text}
parameters:
  temperature: 0.2
```

–ó–∞—Ç–µ–º —Å–±–æ—Ä—â–∏–∫ (Python-—Å–∫—Ä–∏–ø—Ç –∏–ª–∏ —Å–µ—Ä–≤–∏—Å) –¥–µ–ª–∞–µ—Ç:

```python
final_prompt = system_block["content"] + context_block["template"] + user_block["template"]
```

---

–•–æ—Ç–∏—Ç–µ, —è –Ω–∞–±—Ä–æ—Å–∞—é –ø—Ä–∏–º–µ—Ä —Ç–∞–∫–æ–≥–æ ¬´—Å–±–æ—Ä—â–∏–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤¬ª (Python-—É—Ç–∏–ª–∏—Ç–∞ —Å CLI), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –±—Ä–∞—Ç—å YAML-–±–ª–æ–∫–∏ –∏ —Å–æ–±–∏—Ä–∞—Ç—å –∏–∑ –Ω–∏—Ö –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç? –≠—Ç–æ –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –≤—Å—Ç—Ä–æ–∏—Ç—å –≤ Forgejo Actions.




–û—Ç–ª–∏—á–Ω–æ üöÄ –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ¬´—Å–±–æ—Ä—â–∏–∫ –ø—Ä–æ–º–ø—Ç–æ–≤¬ª –Ω–∞ Python. –û–Ω –±—É–¥–µ—Ç:

1. –ß–∏—Ç–∞—Ç—å YAML-–±–ª–æ–∫–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `prompts/`.
2. –°–∫–ª–∞–¥—ã–≤–∞—Ç—å –∏—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (`system ‚Üí context ‚Üí user`).
3. –ü–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (placeholders).
4. –ü–µ—á–∞—Ç–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (–∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ —Ñ–∞–π–ª).

---

## 1. –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

```
prompts/
  system_instructions_v1.yaml
  context_block_v1.yaml
  user_input_v1.yaml
scripts/
  build_prompt.py
```

---

## 2. –ü—Ä–∏–º–µ—Ä –±–ª–æ–∫–æ–≤

**system\_instructions\_v1.yaml**

```yaml
id: system_instructions_v1
type: system
version: 1.0.0
description: "–†–æ–ª—å –∏ –ø—Ä–∞–≤–∏–ª–∞"
content: |
  –í—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ AI, –∫–æ—Ç–æ—Ä—ã–π –∫—Ä–∞—Ç–∫–æ —Å—É–º–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç.
  –û—Ç–≤–µ—á–∞–π—Ç–µ —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å –ø–æ–ª–µ–º summary.
```

**context\_block\_v1.yaml**

```yaml
id: context_block_v1
type: context
version: 1.0.0
description: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
template: |
  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
  {retrieved_context}
```

**user\_input\_v1.yaml**

```yaml
id: user_input_v1
type: user
version: 1.0.0
description: "–í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
template: |
  –°—É–º–º–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç:
  {text}
parameters:
  temperature: 0.2
  max_tokens: 300
```

---

## 3. –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏ (scripts/build\_prompt.py)

```python
#!/usr/bin/env python3
import yaml
import pathlib
import argparse

def load_blocks(path="prompts"):
    blocks = {}
    for file in pathlib.Path(path).glob("*.yaml"):
        with open(file, encoding="utf-8") as f:
            block = yaml.safe_load(f)
            blocks[block["id"]] = block
    return blocks

def render_template(template: str, variables: dict) -> str:
    return template.format(**variables)

def build_prompt(blocks, order, variables):
    parts = []
    for block_id in order:
        block = blocks[block_id]
        if "content" in block:
            parts.append(block["content"])
        elif "template" in block:
            parts.append(render_template(block["template"], variables))
    return "\n\n".join(parts)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Assemble modular prompts from YAML blocks")
    parser.add_argument("--text", required=True, help="User text to summarize")
    parser.add_argument("--context", default="–ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞", help="Retrieved context")
    args = parser.parse_args()

    blocks = load_blocks("prompts")
    order = ["system_instructions_v1", "context_block_v1", "user_input_v1"]

    variables = {
        "text": args.text,
        "retrieved_context": args.context,
    }

    final_prompt = build_prompt(blocks, order, variables)
    print("==== Final Prompt ====")
    print(final_prompt)
```

---

## 4. –ó–∞–ø—É—Å–∫

```bash
chmod +x scripts/build_prompt.py

./scripts/build_prompt.py \
  --text "LLMs –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ..." \
  --context "–ü—Ä–∏–º–µ—Ä: OpenAI GPT-4, Anthropic Claude"
```

**–í—ã–≤–æ–¥:**

```
==== Final Prompt ====
–í—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ AI, –∫–æ—Ç–æ—Ä—ã–π –∫—Ä–∞—Ç–∫–æ —Å—É–º–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç.
–û—Ç–≤–µ—á–∞–π—Ç–µ —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å –ø–æ–ª–µ–º summary.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
–ü—Ä–∏–º–µ—Ä: OpenAI GPT-4, Anthropic Claude

–°—É–º–º–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç:
LLMs –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...
```

---

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É –≤–∞—Å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤. –ï–≥–æ –º–æ–∂–Ω–æ:

* –∑–∞–ø—É—Å–∫–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤,
* –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤ Forgejo Actions (—á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —Å–±–æ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç),
* –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É—Å–ª–æ–∂–Ω—è—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±–∏—Ä–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –±–ª–æ–∫–æ–≤ –ø–æ `semver`).

---

–•–æ—Ç–∏—Ç–µ, —è –ø–æ–∫–∞–∂—É **–∫–∞–∫ –≤—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤ Forgejo Actions** —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º `push` —Å–æ–±–∏—Ä–∞–ª—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç?
