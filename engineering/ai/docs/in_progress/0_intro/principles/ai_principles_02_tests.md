# Основные принципы разработки с LLM для внутренних команд

> Владелец: Вадим Рудаков, lefthand67@gmail.com

Cоздание рабочей системы на базе LLM — это не просто написание промптов и соединение с внешними компонентами. Следует ясно отделять “технократические поделки” от продуктовой инженерии. Нижеизложенные принципы нацелены на то, чтобы помочь инженеру выстроить жизнеспособную систему, соответствующую промышленным стандартам разработки и эксплуатации.

# 2. Тестирование LLM-решений: ставка на качество и надёжность

Тестирование в LLM сильно отличается от классического софта. “Ожидаемость” результата здесь вероятностная.

## 2.1 Test-Driven Development (TDD)  

Тесты служат спецификацией и проверкой при итеративной доработке промптов и систем.

Начинать разработку следует с подготовки тестов (функциональных требований):  
- сначала определять требования и тесты, описывающие желаемое поведение, а потом уже писать промпты/агентов.
- Это снижает риски частых изменений и нестабильности результата.

## 2.2 Характеристики тестов  

Метрики качества BLEU/ROUGE неприменимы напрямую — нужны кастомные проверки или human-in-the-loop.

Результат генерации LLM — вероятностный, поэтому:  
- тесты должны проверять **диапазон допустимых ответов**, а не строгие совпадения,  
- использовать метрики качества, адаптированные под задачу (например, точность ключевых фактов, полнота),  
- Обязателен человек для проверки сложных или неоднозначных ответов 
  - включать механизмы **human-in-the-loop** для контроля и улучшения.
- Зависимость качества ответа от seed/model version - нельзя полагаться только на прогоны “однажды”.

## 2.3 Автоматизация и виды тестов
- Писать многоуровневые тесты для типовых сценариев, включая edge cases и стресс-тесты.
- Разделять тесты на:
  - **фуззинг-ориентированные** - проверка на неожиданные edge cases,
  - **юнит-тесты промптов** - функциональное поведение конкретных запросов с проверкой на ожидаемые шаблоны ответов,
  - **интеграционные тесты** для цепочек агентов и взаимодействия между моделями,
  - **регрессионные тесты** - устойчивость к изменениям модели/версии, отслеживать влияние обновлений модели или промптов.
  
> **Предупреждение**: Автотесты могут генерироваться LLM и даже полезны для масштабирования, но только при обязательном внешнем ревью, чтобы избежать самоподтверждения.

### 2.4 Фиксация модели и параметров в тестах 

Важно фиксировать версии моделей и параметры генерации при тестировании, так как малейшие изменения могут влиять на ответы. Следует блокировать:

- версии моделей,
- значения temperature, 
- max tokens, 
- stop sequences  
и другие параметры генерации для стабильности результатов.